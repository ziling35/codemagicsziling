# å¤šé˜¶æ®µæ„å»º Dockerfile
# é˜¶æ®µ1: æ„å»º React åº”ç”¨
FROM node:18-alpine AS builder

WORKDIR /app

# å¤åˆ¶ package.json å’Œ package-lock.json
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm install

# å¤åˆ¶æ‰€æœ‰æ–‡ä»¶
COPY . .

# æ¥æ”¶æ„å»ºå‚æ•°
ARG REACT_APP_API_HOST
ENV REACT_APP_API_HOST=$REACT_APP_API_HOST

# è°ƒè¯•ï¼šæ˜¾ç¤º API_HOST å€¼
RUN echo "ğŸ” Building with API_HOST: $REACT_APP_API_HOST"

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
RUN npm run build

# é˜¶æ®µ2: ä½¿ç”¨ Nginx æä¾›é™æ€æ–‡ä»¶
FROM nginx:alpine

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/build /usr/share/nginx/html

# å¤åˆ¶ Nginx é…ç½®
COPY nginx.conf /etc/nginx/conf.d/default.conf

# æš´éœ²ç«¯å£
EXPOSE 80

# å¯åŠ¨ Nginx
CMD ["nginx", "-g", "daemon off;"]
